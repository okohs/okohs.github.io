$(function(){function e(e){var n=new Date,t=new Date(n.getTime()-284256e5),i=o.history(),u=[];i.sort("desc").size(100).span(t.getTime(),n.getTime()),i.on("data",function(e){u=u.concat(e).filter(function(e){return!e.value.deleted})}),i.on("end",function(){e(u)}),i.on("error",function(e){console.log(e)}),i.run()}function n(e,n,t,o,i){var u=o||"",c=a.createFusen(e,u,i);c.setPos(n,t)}var t=navigator.userAgent,o=milkcocoa.dataStore("fusen"),i="one",u=$("#canvas"),a=new FusenBuilder(u,o),c=100,l=function(){},r=function(){},s="pc";s=t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("iPod")>0||t.indexOf("Android")>0?"mobile":"pc",$(".p-colorlist__item").click(function(e){i=$(this).attr("id"),$(".p-colorlist__item").each(function(){$(this).removeClass("is-active")}),$(this).addClass("is-active"),e.stopPropagation()}),e(function(e){for(var t=e.length>c?c:e.length,o=0;t>o;o++)n(e[o].id,e[o].value.x,e[o].value.y,e[o].value.text,e[o].value.color)}),r=function(e){a.getFusen(e.id).removeSelf()},l=function(e){a.getFusen(e.id).setPos(e.value.x,e.value.y)},o.on("push",function(e){n(e.id,e.value.x,e.value.y,e.value.text,e.value.color)}),o.on("set",function(e){e.value.deleted?r(e):l(e)}),o.on("set",function(e){a.getFusen(e.id).setPos(e.value.x,e.value.y)}),o.on("remove",function(e){var n=e;a.getFusen(n.id).removeSelf()}),u.click(function(e){var n=prompt("Twitterアカウントを入力してください。"),t=i;n&&o.push({x:e.pageX,y:e.pageY,text:fusen_util.htmlEscape(n),color:t})}),window.fusen_util={getDevice:function(){return s},htmlEscape:function(e){return e=e.replace(/@/g,""),e=e.replace(/&/g,"&amp;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/</g,"&lt;")}}});